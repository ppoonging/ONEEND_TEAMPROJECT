<!DOCTYPE html>
<html layout:decorate="~{layout}">
<main layout:fragment="content">

    <div class="d-flex justify-content-center align-items-center page-total-main-bg mb-5 shadow-sm">
        <h2 class="text-center text-white py-2 font-bold-style">ÎßõÏßë ÏÜåÍ∞ú</h2>
    </div>
    <div class="container py-5">

        <!-- Í≤ÄÏÉâ Ìèº -->
        <form th:action="@{/mjboard/list}" method="get" class="text-center mb-4" style="display: flex; justify-content: center; gap: 10px;">
            <!-- Í≤ÄÏÉâ ÌÉÄÏûÖ ÎìúÎ°≠Îã§Ïö¥ -->
            <select name="searchType" style="padding: 8px; border: 1px solid #ccc; border-radius: 5px;">
                <option value="title" th:selected="${searchType == 'title'}">Ï†úÎ™©</option>
                <option value="content" th:selected="${searchType == 'content'}">ÎÇ¥Ïö©</option>
                <option value="both" th:selected="${searchType == 'both'}">Ï†úÎ™©+ÎÇ¥Ïö©</option>
            </select>
            <!-- Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• ÌïÑÎìú -->
            <input type="text" name="kw" placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†•" th:value="${kw}"
                   style="width: 300px; padding: 8px; border: 1px solid #ccc; border-radius: 5px;">
            <!-- Í≤ÄÏÉâ Î≤ÑÌäº -->
            <button type="submit" style="padding: 8px 16px; border: none; background: #D5C9C1; color: white; border-radius: 5px;">Í≤ÄÏÉâ</button>
        </form>

        <!-- Ï†ïÎ†¨ Î≤ÑÌäº Ï∂îÍ∞Ä -->
        <div class="d-flex justify-content-start mb-3">
            <a th:href="@{/mjboard/list(sort='recent', kw=${kw}, searchType=${searchType})}"
               class="btn btn-sm"
               th:classappend="${sort == 'recent'} ? 'btn-dark' : 'btn-outline-dark'">ÏµúÏã†Ïàú</a>

            <a th:href="@{/mjboard/list(sort='popular', kw=${kw}, searchType=${searchType})}"
               class="btn btn-sm"
               th:classappend="${sort == 'popular'} ? 'btn-danger' : 'btn-outline-danger'">Ï∂îÏ≤úÏàú</a>

            <a th:href="@{/mjboard/list(sort='view', kw=${kw}, searchType=${searchType})}"
               class="btn btn-sm"
               th:classappend="${sort == 'view'} ? 'btn-primary' : 'btn-outline-primary'">Ï°∞ÌöåÏàú</a>
        </div>


        <!-- Í≤åÏãúÍ∏Ä Ïπ¥Îìú Î¶¨Ïä§Ìä∏ -->
        <div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
            <div class="col" th:each="mjboard : ${paging}">
                <div class="card h-100">
                    <!-- Ïç∏ÎÑ§ÏùºÏóê ÎßÅÌÅ¨ Ï∂îÍ∞Ä -->
                    <a th:href="@{/mjboard/detail/{id}(id=${mjboard.mjSeq})}">
                        <img th:if="${imageUrlMap[mjboard.mjSeq] != null}"
                             th:src="${imageUrlMap[mjboard.mjSeq]}"
                             class="card-img-top"
                             style="height:200px; object-fit:cover;"
                             alt="Ïç∏ÎÑ§Ïùº">
                    </a>

                    <div class="card-body">
                        <h5 class="card-title">
                            <a style="text-decoration: none; color: black"
                               th:href="@{/mjboard/detail/{id}(id=${mjboard.mjSeq})}"
                               th:text="${mjboard.mjTitle}"></a>
                        </h5>
                        <!-- Ï∂îÏ≤ú -->
                        <p class="card-text">üëç Ï∂îÏ≤ú: <span th:text="${#lists.size(mjboard.recommendUsers)}"></span></p>
                        <div class="d-flex justify-content-between align-items-center">
                            <!-- ÌèâÏ†ê -->
                            <div>
                                ÌèâÏ†ê:
                                <span th:each="star : ${#numbers.sequence(1,5)}"
                                      th:classappend="${star <= starCountMap[mjboard.mjSeq]} ? 'text-warning' : 'text-secondary'"
                                      class="bi bi-star-fill"></span>
                            </div>
                            <!-- Ï°∞ÌöåÏàò -->
                            <div>Ï°∞ÌöåÏàò: <span th:text="${mjboard.mjCnt}"></span></div>
                        </div>

                        <!-- ÏûëÏÑ±Ïûê, ÏûëÏÑ±ÏùºÏûê -->
                        <div class="d-flex justify-content-between align-items-center mt-3 pt-2 border-top">
                            <small class="text-muted">
                                <i class="bi bi-person-fill"></i>
                                <span th:text="${mjboard.userId.nickname}"></span>
                            </small>
                            <small class="text-muted">
                                <i class="bi bi-calendar-week"></i>
                                <span th:text="${#temporals.format(mjboard.mjRegDate, 'yyyy-MM-dd HH:mm')}"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÌéòÏù¥Ïßï -->
        <div class="d-flex justify-content-center mt-4">
            <ul class="pagination">
                <li class="page-item" th:classappend="${paging.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/mjboard/list(page=${paging.number-1}, kw=${kw}, searchType=${searchType}, sort=${sort})}">¬´</a>
                </li>
                <li th:each="page : ${#numbers.sequence(0, paging.totalPages - 1)}"
                    th:classappend="${page == paging.number} ? 'active'" class="page-item">
                    <a class="page-link" th:href="@{/mjboard/list(page=${page}, kw=${kw}, searchType=${searchType}, sort=${sort})}" th:text="${page+1}"></a>
                </li>
                <li class="page-item" th:classappend="${paging.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/mjboard/list(page=${paging.number+1}, kw=${kw}, searchType=${searchType}, sort=${sort})}">¬ª</a>
                </li>
            </ul>
        </div>

        <!-- ÎßõÏßë Îì±Î°ù Î≤ÑÌäº -->
        <div class="d-flex justify-content-end mb-3">
            <a th:href="@{/mjboard/create}" class="btn btn-sm btn-danger">ÎßõÏßë Îì±Î°ù</a>
        </div>

    </div>
</main>
</html>
